# L4
トランスポート層のこと。ポートを使用してアプリを識別する。

## TCP
信頼性を最優先し、対話して確実にデータを送るプロトコル。3ウェイ・ハンドシェイクを使用する。WebやSSHなどに使用される。

## 3ウェイ・ハンドシェイク
TCPで使用される仕組みで、通信を開始する前に互いの準備ができているかどうかを確認して同期をとる。  
1. SYN クライアント側からの接続要求
2. SYN, ACK サーバー側からの応答
3. ACK 接続確立（クライアント側）
4. DATA(PSH, ACK) クライアント側からのデータ送信とハンドシェイクが正しく行われているという応答

## UDP
速度と効率を最優先し、対話をせずにデータを一方的に送り付けるプロトコル。コネクションレスで相手の状態を確認せず、届いたかどうかの確認もしない。動画配信やDNSなどに使用される。

## tcpdump
```bash
tcpdump -i <インターネットインターフェース> # 指定したインターネットインターフェースに対するパケットをキャプチャする。
tcpdump -i <インターネットインターフェース> port 8080 # 指定したインターネットインターフェースに対するパケットで、ポートが8080のものをキャプチャする。
tcpdump -i eth0 udp port 53 # DNS通信のみ傍受
-S # シーケンス番号を相対値でなく、絶対値で表示
-n # IPアドレスやポートを名前解決せず、数字のまま表示する。
# ログ
[S] SYN
[S.] SYN, ACK
[.] ACK
[P.] PSH, ACK
[F.] FIN, ACK
[R.] RST, ACK
```
